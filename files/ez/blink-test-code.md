```c
#define D_app_test
#ifdef D_app_test
// 39MHz时钟下，每个周期约25.64ns
#define CPU_FREQ_MHZ 39

// 内联汇编实现微秒延时（基于NOP）
static inline void delay_us(uint32_t us)
{
    // 39MHz: 1us = 39个周期
    // 每条NOP指令大约1个周期（取决于CPU架构）
    // 需要减去函数调用开销

    uint32_t cycles = us * CPU_FREQ_MHZ;

    // 减去函数调用和循环开销（约10-20个周期）
    if (cycles > 20) {
        cycles -= 15;
    }

    while (cycles--) {
        __asm__ volatile ("nop");
    }
}

// 毫秒延时函数
void delay_ms(uint32_t ms)
{
    while (ms--) {
        delay_us(1000);  // 延时1ms
    }
}
#define D_TEST_MAX 246
#define D_TEST_MAX2 22
int test_table[D_TEST_MAX][2]={
    { 248,333 },
    { 248,332 },
    { 247,332 },
    { 247,331 },
    { 246,331 },
    { 246,331 },
    { 246,330 },
    { 246,329 },
    { 245,329 },
    { 245,328 },
    { 245,328 },
    { 244,328 },
    { 244,327 },
    { 243,327 },
    { 243,326 },
    { 243,326 },
    { 243,325 },
    { 242,325 },
    { 242,324 },
    { 241,324 },
    { 241,324 },
    { 241,323 },
    { 240,323 },
    { 240,322 },
    { 240,321 },
    { 240,321 },
    { 239,321 },
    { 239,320 },
    { 238,320 },
    { 238,319 },
    { 238,319 },
    { 237,319 },
    { 237,318 },
    { 237,317 },
    { 236,317 },
    { 236,317 },
    { 236,316 },
    { 235,316 },
    { 235,315 },
    { 235,315 },
    { 235,315 },
    { 234,314 },
    { 232,312 },
    { 231,310 },
    { 229,308 },
    { 228,306 },
    { 226,304 },
    { 225,301 },
    { 223,300 },
    { 222,297 },
    { 220,296 },
    { 219,293 },
    { 217,291 },
    { 216,289 },
    { 214,287 },
    { 213,285 },
    { 211,283 },
    { 209,281 },
    { 208,279 },
    { 206,277 },
    { 205,275 },
    { 203,273 },
    { 202,270 },
    { 200,269 },
    { 199,266 },
    { 197,265 },
    { 196,262 },
    { 194,260 },
    { 193,258 },
    { 191,256 },
    { 190,254 },
    { 188,252 },
    { 186,250 },
    { 185,248 },
    { 183,246 },
    { 182,244 },
    { 180,242 },
    { 179,239 },
    { 177,238 },
    { 176,235 },
    { 174,234 },
    { 173,231 },
    { 171,229 },
    { 170,227 },
    { 168,226 },
    { 167,224 },
    { 166,222 },
    { 164,221 },
    { 163,219 },
    { 162,217 },
    { 161,215 },
    { 159,214 },
    { 158,212 },
    { 157,210 },
    { 155,209 },
    { 154,207 },
    { 153,205 },
    { 152,203 },
    { 150,202 },
    { 149,200 },
    { 148,198 },
    { 146,197 },
    { 145,195 },
    { 144,193 },
    { 143,191 },
    { 141,190 },
    { 140,188 },
    { 139,186 },
    { 138,184 },
    { 136,183 },
    { 135,181 },
    { 134,179 },
    { 132,178 },
    { 131,176 },
    { 130,174 },
    { 129,172 },
    { 127,171 },
    { 126,169 },
    { 125,167 },
    { 123,166 },
    { 122,164 },
    { 121,162 },
    { 120,160 },
    { 118,159 },
    { 117,157 },
    { 116,156 },
    { 115,154 },
    { 114,153 },
    { 113,151 },
    { 112,150 },
    { 111,149 },
    { 110,147 },
    { 109,146 },
    { 108,144 },
    { 107,143 },
    { 106,142 },
    { 105,140 },
    { 104,139 },
    { 102,138 },
    { 102,136 },
    { 101,135 },
    { 99,134  },
    { 99,132  },
    { 97,131  },
    { 96,130  },
    { 96,128  },
    { 94,127  },
    { 94,126  },
    { 92,124  },
    { 91,123  },
    { 91,121  },
    { 89,120  },
    { 88,119  },
    { 87,117  },
    { 86,116  },
    { 85,115  },
    { 84,113  },
    { 83,112  },
    { 82,110  },
    { 81,109  },
    { 80,108  },
    { 79,106  },
    { 78,105  },
    { 77,103  },
    { 76,102  },
    { 75,101  },
    { 74,99 },
    { 73,98 },
    { 73,97 },
    { 72,96 },
    { 71,95 },
    { 70,94 },
    { 69,93 },
    { 69,92 },
    { 68,91 },
    { 67,90 },
    { 66,89 },
    { 65,88 },
    { 65,87 },
    { 64,86 },
    { 63,85 },
    { 62,84 },
    { 61,83 },
    { 61,82 },
    { 60,81 },
    { 59,80 },
    { 58,79 },
    { 58,77 },
    { 57,77 },
    { 56,76 },
    { 55,75 },
    { 55,73 },
    { 54,72 },
    { 53,72 },
    { 52,71 },
    { 52,69 },
    { 51,68 },
    { 50,67 },
    { 49,67 },
    { 49,65 },
    { 48,64 },
    { 47,63 },
    { 46,62 },
    { 46,61 },
    { 45,60 },
    { 44,59 },
    { 43,58 },
    { 42,57 },
    { 42,56 },
    { 41,55 },
    { 41,54 },
    { 40,53 },
    { 39,52 },
    { 38,52 },
    { 38,50 },
    { 37,50 },
    { 36,49 },
    { 35,48 },
    { 35,47 },
    { 34,46 },
    { 34,45 },
    { 33,44 },
    { 32,43 },
    { 32,42 },
    { 31,41 },
    { 30,41 },
    { 29,40 },
    { 29,38 },
    { 28,38 },
    { 27,37 },
    { 27,36 },
    { 26,35 },
    { 25,34 },
    { 24,33 },
    { 23,31 },
    { 22,29 },
    { 21,28 },
    { 20,26 },
    { 18,25 },
    { 17,23 },
    { 16,21 },
    { 14,20 },
    { 14,18 },
    { 12,17 },
    { 11,15 },
    { 11,16 },
};
uint8_t app_table2[D_TEST_MAX2][2]={
{	0,104	},
{	1,103	},
{	2,102	},
{	3,101	},
{	4,100	},
{	5,99	},
{	6,98	},
{	7,97	},
{	8,96	},
{	9,95	},
{	10,94	},
{	11,93	},
{	12,92	},
{	13,91	},
{	14,90	},
{	15,89	},
{	16,88	},
{	17,87	},
{	18,86	},
{	19,85	},
{	20,84	},
{	21,84	},
};

void test_pwm_flash(void)
{
    while(1){
        // 测试1：固定值是否闪
        _light_ll_set_level(0,0);
        delay_ms(100);
        #if 0
        // 测试2：0->100渐变
        for (int i = 0; i <= 100; i++) {
            _light_ll_set_level(i*10, i*10);
            delay_ms(10);  // 10ms步进
        }
        #endif
        for (int i = 0; i < D_TEST_MAX; i++) {
            _light_ll_set_level(test_table[i][0], test_table[i][1]);
            delay_ms(100);  // 10ms步进
        }
        _light_ll_set_level(0,0);
        delay_ms(5000);

    }
}
#endif
int app_light_mgr_init(void)
{
    hal_light_init();
#ifdef D_app_test
    g_ll_onoff = 1;
    test_pwm_flash();
#endif
    calulate_exp_table();
#if defined(IGNORE_LEVEL_CONTROL_CLUSTER_ON_OFF_TRANSITION_TIME)
    ev_init(&slsd_timer_event, _slsd_timer_event_handler);
#endif
    ev_init(&breathe_timer_event, _breathe_timer_event_handler);
    ev_init(&startup_timer_event, _startup_timer_event_handler);
    ev_init(&attritube_run_event, _attritube_run_event_handler);
    ev_init(&test_run_event, _test_run_event_handler);
    ev_set_delay_ms(&startup_timer_event, 200);

    return 0;
}
```